<!DOCTYPE html>
<html>
<head>
  <title>RunDown</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230078d4'%3E%3Cpath d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'/%3E%3C/svg%3E">
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="/static/css/styles.css">
  <script src="/static/js/auth_handler.js" defer></script>
</head>
<body>

  <div class="top-nav">
    <div class="logo">RunDown</div>
    <nav class="nav-links">
      <a href="https://outlook.live.com/mail" target="_blank">Emails</a>
      <a href="https://outlook.live.com/calendar" target="_blank">Calendar</a>
      <a href="/preferences">Preferences</a>
      <a href="/logout">Logout</a>
    </nav>
  </div>

  <!-- Toast Notification Container -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Main Content -->
  <div class="main-content">
    <button class="panel-trigger left-trigger" id="left-trigger">Tasks</button>
    <button class="panel-trigger right-trigger" id="right-trigger">Chats</button>

    <div class="main-container">
      <!-- Left Panel -->
      <div class="collapsible-panel" id="left-panel">
        <button class="close-panel-btn">×</button>
        <div class="suggested-section">
          <h1>Suggested Tasks</h1>
          <button id="refresh-sug">Refresh</button>
          <ul id="suggestedList"></ul>
        </div>
      </div>

      <!-- Main Todo Section -->
      <div class="todo-section">
        <h1>UPCOMING TASKS</h1>
        <div class="task-list-container">
          <ul id="taskList"></ul>
        </div>
        <div class="input-container">
          <input type="text" id="taskInput" placeholder="Add a new task...">
          <input type="datetime-local" id="taskDeadline" class="hidden-datetime">
          <button id="date-picker-btn" class="calendar-btn"><i class="far fa-calendar-alt"></i></button>
          <button id="addTaskBtn">Add</button>
        </div>
      </div>

      <!-- Right Panel -->
      <div class="collapsible-panel" id="right-panel">
        <button class="close-panel-btn">×</button>
        <div class="chat-section">
          <h1>AI Assistant</h1>
          <div class="chat-messages" id="chat-messages">
            <div class="chat-message">How can I help you today?</div>
          </div>
          <div class="input-container">
            <input type="text" id="user-input" placeholder="Type your message...">
            <button id="send-button">Send</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/js/chat.js"></script>
  <script>
    // Toast Notification System
    function showToast(message, type = 'info', duration = 5000) {
      const container = document.getElementById('toast-container');
      if (!container) return;

      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      const icons = {
        error: 'fas fa-exclamation-circle',
        success: 'fas fa-check-circle',
        warning: 'fas fa-exclamation-triangle',
        info: 'fas fa-info-circle'
      };

      toast.innerHTML = `
        <i class="toast-icon ${icons[type]}"></i>
        <div class="toast-message">${message}</div>
        <button class="toast-close" onclick="removeToast(this)">×</button>
      `;

      container.appendChild(toast);

      // Auto remove after duration
      setTimeout(() => {
        removeToast(toast.querySelector('.toast-close'));
      }, duration);
    }

    function removeToast(closeButton) {
      const toast = closeButton.closest('.toast');
      toast.classList.add('slide-out');
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }

    // Override existing error/success displays
    function showError(message) {
      showToast(message, 'error', 5000);
    }

    function showSuccess(message) {
      showToast(message, 'success', 5000);
    }

    function showWarning(message) {
      showToast(message, 'warning', 5000);
    }

    // Replace any existing error messages with toasts
    window.addEventListener('DOMContentLoaded', function() {
      // Look for existing error messages and convert them
      const errorElements = document.querySelectorAll('.error, .error-message, [class*="error"]');
      errorElements.forEach(el => {
        if (el.textContent.trim() && !el.classList.contains('toast')) {
          showError(el.textContent.trim());
          el.style.display = 'none';
        }
      });

      // Look for existing success messages
      const successElements = document.querySelectorAll('.success, .success-message, [class*="success"]');
      successElements.forEach(el => {
        if (el.textContent.trim() && !el.classList.contains('toast')) {
          showSuccess(el.textContent.trim());
          el.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>

